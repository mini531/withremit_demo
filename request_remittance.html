<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>withremit - 해외 송금 신청</title>

    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">

    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body class="db-body">
    <div id="headerContainer"></div>

    <main class="db-main-container container">
        <div class="db-layout-flex">
            <div id="sidebarContainer"></div>

            <div class="db-content">
                <div class="db-page-header">
                    <h1 class="db-page-title">해외 송금 신청</h1>
                </div>

                <div class="db-content-card">
                    <!-- 한도액 안내 -->
                    <div class="limit-info-grid">
                        <div class="limit-info-item">
                            <div class="limit-label">1회 한도액</div>
                            <div class="limit-value">$ 50,000</div>
                        </div>
                        <div class="limit-info-item">
                            <div class="limit-label">1년 한도액</div>
                            <div class="limit-value">$ 100,000</div>
                        </div>
                        <div class="limit-info-item">
                            <div class="limit-label">송금액</div>
                            <div class="limit-value">$ 50,000.00</div>
                        </div>
                        <div class="limit-info-item highlight">
                            <div class="limit-label">송금 가능 금액</div>
                            <div class="limit-value">$ 50,000.00</div>
                        </div>
                    </div>

                <!-- 송금 정보 입력 -->
                <div class="remit-form-section">
                    <h2 class="form-sec-head">송금 정보 입력</h2>

                    <div class="form-sec">
                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">국가</label>
                                <select class="login-input select-styled" id="remitCountry">
                                    <option value="" disabled selected>선택</option>
                                    <option value="JP">일본 (JPY)</option>
                                    <option value="PH">필리핀 (PHP)</option>
                                    <option value="CN">중국 (CNY)</option>
                                    <option value="NP">네팔 (NPR)</option>
                                    <option value="AU">호주 (AUD)</option>
                                    <option value="HK">홍콩 (HKD)</option>
                                    <option value="MN">몽골 (MNT)</option>
                                    <option value="VN">베트남 (VND)</option>
                                    <option value="LK">스리랑카 (LKR)</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">서비스 선택</label>
                                <select class="login-input select-styled" id="remitService" disabled>
                                    <option value="" disabled selected>선택</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">송금액 설정</label>
                                <div class="field-flex h-52">
                                    <label class="radio-wrap">
                                        <input type="radio" name="amountType" value="send" checked>
                                        <span class="custom-radio"></span>
                                        <span>송금액 기준</span>
                                    </label>
                                    <label class="radio-wrap">
                                        <input type="radio" name="amountType" value="receive">
                                        <span class="custom-radio"></span>
                                        <span>수취 금액 기준</span>
                                    </label>
                                </div>
                            </div>
                            <div class="field-item" id="exchangeRateDisplay" style="display: none;">
                                <label class="field-label">환율</label>
                                <div class="login-input" style="display: flex; align-items: center; background: var(--bg-light); border-color: transparent; font-weight: 600; color: var(--text-dark);">
                                    <span id="exchangeRate">-</span>
                                </div>
                            </div>
                        </div>

                        <div class="field-item top-level">
                            <label class="field-label" id="amountLabel">송금 금액</label>
                            <div class="field-flex">
                                <div style="position: relative; flex: 1; display: flex; align-items: center;">
                                    <span id="currencySymbol" style="position: absolute; left: 16px; font-weight: 700; font-size: 1rem; color: var(--text-dark); max-width: 50px; overflow: hidden; text-overflow: ellipsis;">₩</span>
                                    <input type="text" placeholder="송금 금액을 입력하세요" class="login-input" id="sendAmount" style="padding-left: 58px;">
                                </div>
                                <button type="button" class="btn-sub-action" onclick="calculateRemit()">계산하기</button>
                            </div>
                        </div>

                        <div class="remit-calc-result" id="calcResult" style="display: none;">
                            <div class="calc-result-grid">
                                <div class="calc-grid-item">
                                    <div class="calc-item-label">송금 금액</div>
                                    <div class="calc-item-value" id="displaySendAmount">-</div>
                                </div>
                                <div class="calc-grid-item">
                                    <div class="calc-item-label">송금 수수료</div>
                                    <div class="calc-item-value" id="remitFee">-</div>
                                </div>
                                <div class="calc-grid-item">
                                    <div class="calc-item-label">수취 금액</div>
                                    <div class="calc-item-value" id="receiveAmount">-</div>
                                </div>
                                <div class="calc-grid-item" id="withdrawalFeeRow" style="display: none;">
                                    <div class="calc-item-label">출금 수수료</div>
                                    <div class="calc-item-value" id="withdrawalFeeAmount">-</div>
                                </div>
                                <div class="calc-grid-item">
                                    <div class="calc-item-label">입금액</div>
                                    <div class="calc-item-value" id="depositAmount">-</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 입금은행 선택 -->
                <div class="remit-form-section">
                    <h2 class="form-sec-head">입금은행 선택</h2>

                    <div class="form-sec">
                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">입금 은행</label>
                                <select class="login-input select-styled" id="depositBank">
                                    <option value="" disabled selected>선택</option>
                                    <option value="ibk">기업은행 (IBK)</option>
                                    <option value="nh">농협은행 (NONGHYUP BANK)</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">입금자 명</label>
                                <input type="text" placeholder="입금자 명을 입력하세요" class="login-input" id="depositorName" value="홍길동">
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">입금 계좌</label>
                                <input type="text" placeholder="계좌번호를 입력하세요" class="login-input" id="depositAccount">
                            </div>
                            <div class="field-item">
                                <label class="field-label">입금 계좌 명의</label>
                                <input type="text" placeholder="계좌 명의를 입력하세요" class="login-input" id="accountHolder">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 수취 정보 입력 -->
                <div class="remit-form-section">
                    <h2 class="form-sec-head">수취 정보 입력</h2>

                    <div class="form-sec">
                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">수취인명(영문)</label>
                                <input type="text" placeholder="영문으로 입력하세요" class="login-input" id="beneficiaryName">
                            </div>
                            <div class="field-item">
                                <label class="field-label">수취인과의 관계</label>
                                <select class="login-input select-styled" id="relationship">
                                    <option value="">선택</option>
                                    <option value="R01">본인</option>
                                    <option value="R02">자식</option>
                                    <option value="R03">부모</option>
                                    <option value="R04">형제</option>
                                    <option value="R05">조카</option>
                                    <option value="R06">친척</option>
                                    <option value="R07">사업파트너</option>
                                    <option value="R08">친구</option>
                                    <option value="R09">배우자</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">수취 은행</label>
                                <select class="login-input select-styled" id="beneficiaryBank">
                                    <option value="">선택</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">은행 지점번호</label>
                                <input type="text" placeholder="지점번호를 입력하세요" class="login-input" id="branchNumber">
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">수취 계좌 번호</label>
                                <input type="text" placeholder="계좌번호를 입력하세요" class="login-input" id="beneficiaryAccount">
                            </div>
                            <div class="field-item">
                                <label class="field-label">수취 계좌 타입</label>
                                <select class="login-input select-styled" id="accountType">
                                    <option value="">선택</option>
                                    <option value="1">Futuu 저축계좌</option>
                                    <option value="2">Touza 당좌계좌</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">송금 목적</label>
                                <select class="login-input select-styled" id="remitPurpose">
                                    <option value="" disabled selected>선택</option>
                                    <option value="family">가족 송금</option>
                                    <option value="education">교육비</option>
                                    <option value="living">생활비</option>
                                    <option value="medical">의료비</option>
                                    <option value="business">사업</option>
                                    <option value="investment">투자</option>
                                    <option value="gift">선물</option>
                                    <option value="other">기타</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">자금 출처</label>
                                <select class="login-input select-styled" id="fundSource">
                                    <option value="">선택</option>
                                    <option value="SF01">월급</option>
                                    <option value="SF02">부동산/동산 판매이익</option>
                                    <option value="SF03">저축</option>
                                    <option value="SF04">투자이익</option>
                                    <option value="SF05">연금</option>
                                    <option value="SF06">사업수입</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">전화번호</label>
                                <input type="text" placeholder="수취인 전화번호" class="login-input" id="beneficiaryPhone">
                            </div>
                            <div class="field-item">
                                <label class="field-label">은행 지점번호</label>
                                <input type="text" placeholder="은행 지점번호를 입력하세요" class="login-input" id="bankBranchNumber">
                            </div>
                        </div>

                        <div class="field-item top-level">
                            <label class="field-label">주소</label>
                            <textarea class="login-input textarea-input" placeholder="수취인 주소를 입력하세요" id="beneficiaryAddress" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                    <!-- 하단 버튼 -->
                    <div class="remit-action-btns">
                        <button type="button" class="btn btn-outline btn-remit-cancel" onclick="location.href='dashboard.html'">취소</button>
                        <button type="button" class="btn btn-primary" onclick="submitRemittance()">송금 신청</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="contactContainer"></div>
    <div id="footerContainer"></div>

    <div class="db-overlay" id="dbOverlay"></div>

    <!-- 송금 신청 완료 모달 -->
    <div id="remitCompleteModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#00A0DC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11"></polyline>
                </svg>
            </div>
            <h3>송금 신청 완료</h3>
            <p>송금 신청이 정상적으로 접수되었습니다.<br>처리 결과는 SMS 및 이메일로 안내드립니다.</p>
            <button class="modal-btn-warning" style="background-color: var(--primary-green);" onclick="closeRemitModal()">확인</button>
        </div>
    </div>

    <!-- 경고 모달 -->
    <div id="warningModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            <h3 id="warningTitle">안내</h3>
            <p id="warningMessage"></p>
            <button class="modal-btn-warning" onclick="closeWarningModal()">확인</button>
        </div>
    </div>

    <!-- 한도 초과 모달 -->
    <div id="limitModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            <h3>송금 한도 초과</h3>
            <p id="limitModalMessage"></p>
            <button class="modal-btn-warning" onclick="closeLimitModal()">확인</button>
        </div>
    </div>

    <script src="js/sidebar.js"></script>
    <script src="js/includes.js"></script>
    <script>
        // 환율 데이터
        const exchangeRates = {
            JP: { rate: 0.1112, name: '일본', currency: '엔', symbol: '¥', withdrawalFee: 660 },
            PH: { rate: 0.0421, name: '필리핀', currency: '페소', symbol: '₱', withdrawalFee: 40129 },
            CN: { rate: 0.0054, name: '중국', currency: '위안', symbol: '¥', withdrawalFee: 4713 },
            NP: { rate: 0.1004, name: '네팔', currency: '루피', symbol: 'रू', withdrawalFee: 97607 },
            AU: { rate: 0.0011, name: '호주', currency: '달러', symbol: 'A$', withdrawalFee: 0 },
            HK: { rate: 0.0059, name: '홍콩', currency: '달러', symbol: 'HK$', withdrawalFee: 0 },
            MN: { rate: 2.5830, name: '몽골', currency: '투그릭', symbol: '₮', withdrawalFee: 0 },
            VN: { rate: 18.5200, name: '베트남', currency: '동', symbol: '₫', withdrawalFee: 0 },
            LK: { rate: 0.2450, name: '스리랑카', currency: '루피', symbol: '௹', withdrawalFee: 0 }
        };

        // 국가별 서비스 옵션 (서비스명과 변경가능 여부)
        const servicesByCountry = {
            JP: [{ value: 'JP_REMIT', text: '일본 송금', locked: true }],
            PH: [
                { value: 'PH_BANK', text: '필리핀은행 송금', locked: false },
                { value: 'PH_PICKUP', text: '필리핀 Pickup', locked: false }
            ],
            CN: [{ value: 'CN_REMIT', text: '중국 송금', locked: true }],
            NP: [{ value: 'NP_REMIT', text: '네팔 송금', locked: true }],
            AU: [{ value: 'AU_REMIT', text: '호주 송금', locked: true }],
            HK: [{ value: 'HK_REMIT', text: '홍콩 송금', locked: true }],
            MN: [{ value: 'MN_REMIT', text: '몽고 송금', locked: true }],
            VN: [{ value: 'VN_REMIT', text: '베트남 송금', locked: true }],
            LK: [{ value: 'LK_REMIT', text: '스리랑카 송금', locked: true }]
        };

        // 국가별 은행 목록 (일본은 전체 목록)
        const banksByCountry = {
            JP: [
                { value: '', text: '선택' },
                { value: '0117', text: '青森みちのく銀行/아오모리미츠노쿠은행' },
                { value: '0125', text: '七十七銀行/시찌쥬시찌은행' },
                { value: '0310', text: 'GMO あおぞら銀行/GMO아오조라은행' },
                { value: '0397', text: 'SBI新生銀行 / SBI신세이은행' },
                { value: '100', text: 'ゆうちょ銀行 / 유쵸은행' },
                { value: '101', text: '三菱UFJ銀行 / 미츠비시UFJ은행' },
                { value: '102', text: '三井住友銀行 / 미쓰이스미토모은행' },
                { value: '103', text: 'みずほ銀行 / 미즈호 은행' },
                { value: '1336', text: '西京信用金庫/사이쿄신용금고' },
                { value: '201', text: '住信ＳＢＩネット銀行 / 스미신SBI네트은행' },
                { value: '202', text: '楽天銀行 / 락텐은행' },
                { value: '203', text: 'セブン銀行 / 세븐은행' },
                { value: '204', text: 'ソニー銀行 / 쏘니은행' },
                { value: '205', text: 'ＰａｙＰａｙ銀行 / PAYPAY은행（旧ジャパンネット銀行）' },
                { value: '206', text: 'イオン銀行 / 이온은행' },
                { value: '207', text: 'AUじぶん銀行 / AU지분은행' },
                { value: '301', text: 'スルガ銀行 / 스루가은행' },
                { value: '303', text: 'りそな銀行 / 리소나은행' },
                { value: '304', text: '阿波銀行 / 아와은행' },
                { value: '305', text: '伊予銀行 / 이요은행' },
                { value: '306', text: '横浜銀行 / 요코하마은행' },
                { value: '307', text: '沖縄銀行 / 오키나와은행' },
                { value: '308', text: '岩手銀行 / 이와테은행' },
                { value: '309', text: '紀陽銀行 / 키요은행' },
                { value: '310', text: '宮崎銀行 / 미야자키은행' },
                { value: '311', text: '京都銀行 / 교토은행' },
                { value: '313', text: '群馬銀行 / 군마은행' },
                { value: '314', text: '広島銀行 / 히로시마은행' },
                { value: '315', text: '佐賀銀行 / 사가은행' },
                { value: '316', text: '埼玉りそな銀行 / 사이타마 리소나 은행' },
                { value: '318', text: '山陰合同銀行 / 산인고도은행' },
                { value: '319', text: '山形銀行 / 야마가타은행' },
                { value: '320', text: '山口銀行 / 야마구치은행' },
                { value: '321', text: '山梨中央銀行 / 야마나시추오은행' },
                { value: '322', text: '四国銀行 / 시코쿠은행' },
                { value: '323', text: '滋賀銀行 / 시가은행' },
                { value: '324', text: '鹿児島銀行 / 카고시마은행' },
                { value: '326', text: '秋田銀行 / 아키타은행' },
                { value: '328', text: '十六銀行 / 쥬로쿠은행' },
                { value: '329', text: '常陽銀行 / 조요은행' },
                { value: '330', text: '親和銀行 / 신와은행' },
                { value: '331', text: '清水銀行 / 시미즈은행' },
                { value: '332', text: '西日本シティ銀行 / 니시니폰씨티은행' },
                { value: '334', text: '静岡銀行 / 시즈오카은행' },
                { value: '335', text: '千葉興業銀行 / 치바코교은행' },
                { value: '336', text: '千葉銀行 / 치바은행' },
                { value: '337', text: '荘内銀行 / 쇼나이은행' },
                { value: '338', text: '足利銀行 / 아시카가은행' },
                { value: '339', text: '大垣共立銀行 / 오오가키쿄리츠은행' },
                { value: '340', text: '大分銀行 / 오이타은행' },
                { value: '341', text: '第四北越銀行 / 다이시호쿠에츠은행' },
                { value: '342', text: '但馬銀行 / 타지마은행' },
                { value: '343', text: '池田泉州銀行 / 이케다센슈은행' },
                { value: '344', text: '筑波銀行 / 츠쿠바은행' },
                { value: '345', text: '筑邦銀行 / 치쿠호은행' },
                { value: '346', text: '中国銀行 / 추고쿠은행' },
                { value: '347', text: '鳥取銀行 / 돗토리은행' },
                { value: '349', text: '東邦銀行 / 도호은행' },
                { value: '350', text: '東北銀行 / 도호쿠은행' },
                { value: '351', text: '南都銀行 / 난토은행' },
                { value: '352', text: '八十二銀行 / 하치쥬니은행' },
                { value: '353', text: '肥後銀行 / 히고은행' },
                { value: '354', text: '百五銀行 / 햐쿠고은행' },
                { value: '355', text: '百十四銀行 / 햐쿠쥬시은행' },
                { value: '356', text: '富山銀行 / 도야마은행' },
                { value: '357', text: '武蔵野銀行 / 무사시노은행' },
                { value: '358', text: '福井銀行 / 후쿠이은행' },
                { value: '359', text: '福岡銀行 / 후쿠오카은행' },
                { value: '361', text: '北海道銀行 / 홋카이도은행' },
                { value: '362', text: '北九州銀行 / 기타큐슈은행' },
                { value: '363', text: '北都銀行 / 호쿠토은행' },
                { value: '364', text: '北陸銀行 / 호쿠리쿠은행' },
                { value: '365', text: '北國銀行 / 홋코쿠은행' },
                { value: '366', text: '琉球銀行 / 류큐은행' },
                { value: '605', text: 'みずほ信託銀行 / 미즈호신탁은행' },
                { value: '606', text: '三井住友信託銀行 / 미츠이스미토모신탁은행' },
                { value: '607', text: '三菱ＵＦＪ信託銀行 / 미쓰비시 UFJ 신탁은행' },
                { value: '612', text: '日本マスタートラスト信託銀行 / 일본마스터토라스토신탁은행' },
                { value: '614', text: '野村信託銀行 / 노무라신탁은행' },
                { value: '615', text: '京葉銀行 / 게이요은행' },
                { value: '616', text: '東日本銀行 / 히가시니폰은행' },
                { value: '617', text: '東京スター銀行 / 도쿄스타은행' },
                { value: '618', text: '神奈川銀行 / 카나가와은행' },
                { value: '619', text: '大光銀行 / 다이코은행' },
                { value: '620', text: '長野銀行 / 나가노은행' },
                { value: '621', text: '富山第一銀行 / 토야마다이이치은행' },
                { value: '622', text: '福邦銀行 / 후쿠호은행' },
                { value: '623', text: '静岡中央銀行 / 시즈오카추오은행' },
                { value: '624', text: '愛知銀行 / 아이치은행' },
                { value: '625', text: '名古屋銀行 / 나고야은행' },
                { value: '626', text: '中京銀行 / 추쿄은행' },
                { value: '628', text: '関西みらい銀行 / 간사이미라이은행' },
                { value: '630', text: 'みなと銀行 / 미나토은행' },
                { value: '631', text: '島根銀行 / 시마네은행' },
                { value: '632', text: 'トマト銀行 / 토마토은행' },
                { value: '633', text: 'もみじ銀行 / 모미지은행' },
                { value: '635', text: '徳島銀行 / 토쿠시마은행' },
                { value: '636', text: '香川銀行 / 카가와은행' },
                { value: '637', text: '愛媛銀行 / 에히메은행' },
                { value: '638', text: '高知銀行 / 고치은행' },
                { value: '639', text: '福岡中央銀行 / 후쿠오카추오은행' },
                { value: '640', text: '佐賀共栄銀行 / 사가쿄에은행' },
                { value: '641', text: '長崎銀行 / 나가사키은행' },
                { value: '642', text: 'オリックス銀行 / 오릭스은행' },
                { value: '643', text: '豊和銀行 / 호와은행' },
                { value: '644', text: '宮崎太陽銀行 / 미야자키타이요은행' },
                { value: '645', text: '南日本銀行 / 미나미니폰은행' },
                { value: '646', text: '沖縄海邦銀行 / 오키나와카이호은행' },
                { value: '649', text: '大和ネクスト銀行 / 다이와넥스트은행' },
                { value: '714', text: 'ジェー・ピー・モルガン・チェース・バンク・ナショナル・アソシエーション / JP모건체이스은행' },
                { value: '715', text: 'シティバンク銀行 / 씨티은행' },
                { value: '719', text: 'ドイツ銀行 / 도이치은행' },
                { value: '723', text: 'バンク・オブ・アメリカ・エヌ・エイ / 뱅크오브아메리카' },
                { value: '726', text: 'ビー・エヌ・ピー・パリバ銀行 / BNP 파리바 은행' },
                { value: '736', text: '香港上海銀行 / 홍콩상하이은행(HSBC)' },
                { value: '806', text: 'あおぞら銀行 / 아오조라은행' },
                { value: '807', text: '北洋銀行 / 호쿠요은행' },
                { value: '808', text: 'きらやか銀行 / 키라야카은행' },
                { value: '809', text: '北日本銀行 / 기타니폰은행' },
                { value: '810', text: '仙台銀行 / 센다이은행' },
                { value: '811', text: '福島銀行 / 후쿠시마은행' },
                { value: '812', text: '大東銀行 / 다이토은행' },
                { value: '813', text: '東和銀行 / 토와은행' },
                { value: '814', text: '栃木銀行 / 토치기은행' },
                { value: '842', text: '熊本銀行 / 쿠마모토은행' },
                { value: '905', text: 'SBJ銀行 / 신한일본은행' }
            ],
            PH: [
                { value: '', text: '선택' },
                { value: 'BDO', text: 'BDO' },
                { value: 'BPI', text: 'BPI' },
                { value: 'METRO', text: 'Metrobank' },
                { value: 'SECURITY', text: 'Security Bank' }
            ],
            CN: [
                { value: '', text: '선택' },
                { value: 'ICBC', text: '중국공상은행' },
                { value: 'CCB', text: '중국건설은행' },
                { value: 'BOC', text: '중국은행' },
                { value: 'ABC', text: '중국농업은행' }
            ],
            NP: [
                { value: '', text: '선택' },
                { value: 'NBL', text: 'Nepal Bank' },
                { value: 'RBB', text: 'Rastriya Banijya Bank' },
                { value: 'NABIL', text: 'Nabil Bank' },
                { value: 'SCB', text: 'Standard Chartered' }
            ],
            AU: [
                { value: '', text: '선택' },
                { value: 'CBA', text: 'Commonwealth Bank' },
                { value: 'WBC', text: 'Westpac' },
                { value: 'ANZ', text: 'ANZ' },
                { value: 'NAB', text: 'NAB' }
            ],
            HK: [
                { value: '', text: '선택' },
                { value: 'HSBC', text: 'HSBC' },
                { value: 'SCB', text: 'Standard Chartered' },
                { value: 'BOC', text: 'Bank of China (HK)' },
                { value: 'HSB', text: 'Hang Seng Bank' }
            ],
            MN: [
                { value: '', text: '선택' },
                { value: 'KHAN', text: 'Khan Bank' },
                { value: 'GOLOMT', text: 'Golomt Bank' },
                { value: 'TDB', text: 'Trade and Development Bank' },
                { value: 'STATE', text: 'State Bank' }
            ],
            VN: [
                { value: '', text: '선택' },
                { value: 'VCB', text: 'Vietcombank' },
                { value: 'BIDV', text: 'BIDV' },
                { value: 'VTB', text: 'VietinBank' },
                { value: 'AGB', text: 'Agribank' }
            ],
            LK: [
                { value: '', text: '선택' },
                { value: 'BOC', text: 'Bank of Ceylon' },
                { value: 'PB', text: 'People\'s Bank' },
                { value: 'COM', text: 'Commercial Bank' },
                { value: 'HNB', text: 'Hatton National Bank' }
            ]
        };

        // 국가 선택 시 처리
        document.getElementById('remitCountry').addEventListener('change', function() {
            const country = this.value;
            const serviceSelect = document.getElementById('remitService');
            const bankSelect = document.getElementById('beneficiaryBank');

            // 모든 입력 값 초기화
            document.getElementById('sendAmount').value = '';
            document.getElementById('calcResult').style.display = 'none';
            document.getElementById('depositBank').value = '';
            document.getElementById('depositorName').value = '홍길동';
            document.getElementById('depositAccount').value = '';
            document.getElementById('accountHolder').value = '';
            document.getElementById('beneficiaryName').value = '';
            document.getElementById('relationship').value = '';
            document.getElementById('branchNumber').value = '';
            document.getElementById('beneficiaryAccount').value = '';
            document.getElementById('accountType').value = '';
            document.getElementById('remitPurpose').value = '';
            document.getElementById('fundSource').value = '';
            document.getElementById('beneficiaryPhone').value = '';
            document.getElementById('bankBranchNumber').value = '';
            document.getElementById('beneficiaryAddress').value = '';

            // 서비스 선택 업데이트
            serviceSelect.disabled = false;
            serviceSelect.innerHTML = '';

            if (servicesByCountry[country]) {
                servicesByCountry[country].forEach((service, index) => {
                    const option = document.createElement('option');
                    option.value = service.value;
                    option.textContent = service.text;
                    if (index === 0) option.selected = true;
                    serviceSelect.appendChild(option);
                });

                // 변경 불가능한 경우 disabled 처리
                if (servicesByCountry[country][0].locked && servicesByCountry[country].length === 1) {
                    serviceSelect.disabled = true;
                }
            }

            // 은행 목록 업데이트
            bankSelect.innerHTML = '';
            if (banksByCountry[country]) {
                banksByCountry[country].forEach(bank => {
                    const option = document.createElement('option');
                    option.value = bank.value;
                    option.textContent = bank.text;
                    if (bank.value === '') {
                        option.disabled = true;
                        option.selected = true;
                    }
                    bankSelect.appendChild(option);
                });
            }

            // 환율 표시 업데이트
            const exchangeRateDisplay = document.getElementById('exchangeRateDisplay');
            if (exchangeRates[country]) {
                const rateInfo = exchangeRates[country];
                const rateFor1000 = (rateInfo.rate * 1000).toLocaleString('ko-KR', {minimumFractionDigits: 3, maximumFractionDigits: 3});
                document.getElementById('exchangeRate').textContent =
                    `₩ 1,000 = ${rateInfo.symbol} ${rateFor1000}`;
                exchangeRateDisplay.style.display = 'block';
            } else {
                exchangeRateDisplay.style.display = 'none';
            }

            // 통화 기호 업데이트 (수취 금액 기준이 선택된 경우)
            const amountType = document.querySelector('input[name="amountType"]:checked').value;
            const currencySymbol = document.getElementById('currencySymbol');
            if (amountType === 'receive' && exchangeRates[country]) {
                currencySymbol.textContent = exchangeRates[country].symbol;
            }
        });

        // 송금액 기준 라디오 버튼 변경 시 통화 기호 및 라벨 업데이트
        document.querySelectorAll('input[name="amountType"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const country = document.getElementById('remitCountry').value;
                const currencySymbol = document.getElementById('currencySymbol');
                const amountLabel = document.getElementById('amountLabel');
                const sendAmountInput = document.getElementById('sendAmount');
                const calcResult = document.getElementById('calcResult');
                const MAX_LIMIT = 50000;
                const KRW_PER_USD = 1350;
                const MAX_KRW_LIMIT = MAX_LIMIT * KRW_PER_USD;

                // 계산 결과 초기화 및 숨김
                calcResult.style.display = 'none';

                // 현재 입력된 금액 읽기
                const currentAmount = sendAmountInput.value.replace(/,/g, '');

                if (this.value === 'send') {
                    currencySymbol.textContent = '₩';
                    amountLabel.textContent = '송금 금액';

                    // 수취 금액 기준에서 송금액 기준으로 변경: 환전 계산
                    if (country && exchangeRates[country] && currentAmount) {
                        const numValue = parseFloat(currentAmount);
                        if (!isNaN(numValue) && numValue > 0) {
                            const convertedAmount = Math.floor(numValue / exchangeRates[country].rate);

                            // 한도액 체크
                            if (convertedAmount > MAX_KRW_LIMIT) {
                                showLimitModal(`외환거래법령에 따라 건당 최대 <b>$${MAX_LIMIT.toLocaleString()}(USD)</b>까지 송금이 가능합니다.<br><br>현재 환율 기준 송금 가능액은 <b>₩${MAX_KRW_LIMIT.toLocaleString()}</b>입니다.`);
                                sendAmountInput.value = MAX_KRW_LIMIT.toLocaleString('ko-KR');
                            } else {
                                sendAmountInput.value = convertedAmount.toLocaleString('ko-KR');
                            }
                        }
                    }
                } else if (this.value === 'receive') {
                    if (country && exchangeRates[country]) {
                        currencySymbol.textContent = exchangeRates[country].symbol;
                    } else {
                        currencySymbol.textContent = '₩';
                    }
                    amountLabel.textContent = '수취 금액';

                    // 송금액 기준에서 수취 금액 기준으로 변경: 환전 계산
                    if (country && exchangeRates[country] && currentAmount) {
                        const numValue = parseFloat(currentAmount);
                        if (!isNaN(numValue) && numValue > 0) {
                            const convertedAmount = Math.floor(numValue * exchangeRates[country].rate);
                            const rateInfo = exchangeRates[country];
                            const foreignLimit = MAX_KRW_LIMIT * rateInfo.rate;

                            // 한도액 체크
                            if (convertedAmount > foreignLimit) {
                                showLimitModal(`외환거래법령에 따라 건당 최대 <b>$${MAX_LIMIT.toLocaleString()}(USD)</b>까지 송금이 가능합니다.<br><br>현재 환율 기준 수취 가능액은 <b>${rateInfo.symbol}${Math.floor(foreignLimit).toLocaleString()}</b>입니다.`);
                                sendAmountInput.value = Math.floor(foreignLimit).toLocaleString('ko-KR');
                            } else {
                                sendAmountInput.value = convertedAmount.toLocaleString('ko-KR');
                            }
                        }
                    }
                }
            });
        });

        // 입력 금액 제한 및 검증 (숫자만 입력, 최대 $50,000)
        let limitModalShown = false;
        document.getElementById('sendAmount').addEventListener('input', function(e) {
            const MAX_LIMIT = 50000;
            const KRW_PER_USD = 1350;
            const MAX_KRW_LIMIT = MAX_LIMIT * KRW_PER_USD;

            const country = document.getElementById('remitCountry').value;
            const amountType = document.querySelector('input[name="amountType"]:checked').value;

            // 숫자와 콤마만 허용
            let inputValue = this.value.replace(/[^\d,]/g, '');

            // 콤마 제거하여 숫자로 변환
            let numValue = parseFloat(inputValue.replace(/,/g, ''));

            if (!isNaN(numValue) && numValue > 0) {
                if (amountType === 'send') {
                    // 송금액 기준: KRW 최대값
                    if (numValue > MAX_KRW_LIMIT) {
                        if (!limitModalShown) {
                            limitModalShown = true;
                            showLimitModal(`외환거래법령에 따라 건당 최대 <b>$${MAX_LIMIT.toLocaleString()}(USD)</b>까지 송금이 가능합니다.<br><br>현재 환율 기준 송금 가능액은 <b>₩${MAX_KRW_LIMIT.toLocaleString()}</b>입니다.`);
                            setTimeout(() => { limitModalShown = false; }, 500);
                        }
                        this.value = MAX_KRW_LIMIT.toLocaleString('ko-KR');
                        return;
                    }
                } else if (amountType === 'receive' && country && exchangeRates[country]) {
                    // 수취 금액 기준: 외화 최대값
                    const rateInfo = exchangeRates[country];
                    const foreignLimit = MAX_KRW_LIMIT * rateInfo.rate;
                    if (numValue > foreignLimit) {
                        if (!limitModalShown) {
                            limitModalShown = true;
                            showLimitModal(`외환거래법령에 따라 건당 최대 <b>$${MAX_LIMIT.toLocaleString()}(USD)</b>까지 송금이 가능합니다.<br><br>현재 환율 기준 수취 가능액은 <b>${rateInfo.symbol}${Math.floor(foreignLimit).toLocaleString()}</b>입니다.`);
                            setTimeout(() => { limitModalShown = false; }, 500);
                        }
                        this.value = Math.floor(foreignLimit).toLocaleString('ko-KR');
                        return;
                    }
                }

                // 숫자 포맷팅
                this.value = numValue.toLocaleString('ko-KR');
            } else if (inputValue === '' || inputValue === '0') {
                this.value = '';
            } else {
                // 숫자가 아닌 경우 이전 값 유지
                this.value = inputValue;
            }
        });

        // 송금 금액 계산
        function calculateRemit() {
            const country = document.getElementById('remitCountry').value;
            const sendAmountInput = document.getElementById('sendAmount').value;
            const amountType = document.querySelector('input[name="amountType"]:checked').value;

            if (!country) {
                showWarning('송금 국가를 선택해주세요.');
                return;
            }

            if (!sendAmountInput) {
                showWarning('송금 금액을 입력해주세요.');
                return;
            }

            const inputAmount = parseFloat(sendAmountInput.replace(/,/g, ''));

            if (isNaN(inputAmount) || inputAmount <= 0) {
                showWarning('올바른 금액을 입력해주세요.');
                return;
            }

            const rateInfo = exchangeRates[country];
            const feeRate = country === 'NP' ? 0.005 : 0.01;
            const MAX_LIMIT = 50000; // $50,000
            const KRW_PER_USD = 1350;
            const MAX_KRW_LIMIT = MAX_LIMIT * KRW_PER_USD;

            // 한도 검증
            if (amountType === 'send' && inputAmount > MAX_KRW_LIMIT) {
                showLimitModal(`외환거래법령에 따라 건당 최대 <b>$${MAX_LIMIT.toLocaleString()}(USD)</b>까지 송금이 가능합니다.<br><br>현재 환율 기준 송금 가능액인 <b>₩${MAX_KRW_LIMIT.toLocaleString()}</b>까지 입력해주세요.`);
                return;
            }

            // 수취 금액 기준일 때 외화 한도 검증
            if (amountType === 'receive') {
                const foreignLimit = MAX_KRW_LIMIT * rateInfo.rate;
                if (inputAmount > foreignLimit) {
                    showLimitModal(`외환거래법령에 따라 건당 최대 <b>$${MAX_LIMIT.toLocaleString()}(USD)</b>까지 송금이 가능합니다.<br><br>현재 환율 기준 수취 가능액인 <b>${rateInfo.symbol}${Math.floor(foreignLimit).toLocaleString()}</b>까지 입력해주세요.`);
                    return;
                }
            }

            let sendAmount, fee, receiveAmtBeforeFee, withdrawalFee, receiveAmt, depositAmount;

            if (amountType === 'send') {
                // 송금액 기준
                sendAmount = inputAmount;
                fee = Math.floor(sendAmount * feeRate);
                receiveAmtBeforeFee = (sendAmount - fee) * rateInfo.rate;
                withdrawalFee = rateInfo.withdrawalFee;
                receiveAmt = receiveAmtBeforeFee - withdrawalFee;
                depositAmount = sendAmount + fee;
            } else {
                // 수취 금액 기준
                receiveAmt = inputAmount;
                withdrawalFee = rateInfo.withdrawalFee;
                receiveAmtBeforeFee = receiveAmt + withdrawalFee;
                const beforeFee = receiveAmtBeforeFee / rateInfo.rate;
                sendAmount = beforeFee / (1 - feeRate);
                fee = Math.floor(sendAmount * feeRate);
                depositAmount = sendAmount + fee;
            }

            // 결과 표시
            document.getElementById('displaySendAmount').textContent =
                `₩ ${sendAmount.toLocaleString('ko-KR', {maximumFractionDigits: 0})}`;
            document.getElementById('remitFee').textContent =
                `₩ ${fee.toLocaleString('ko-KR', {maximumFractionDigits: 0})}`;
            document.getElementById('receiveAmount').textContent =
                `${rateInfo.symbol} ${receiveAmt.toLocaleString('ko-KR', {maximumFractionDigits: 0})}`;
            document.getElementById('depositAmount').textContent =
                `₩ ${depositAmount.toLocaleString('ko-KR', {maximumFractionDigits: 0})}`;

            // 출금 수수료 표시
            const withdrawalFeeRow = document.getElementById('withdrawalFeeRow');
            const withdrawalFeeAmount = document.getElementById('withdrawalFeeAmount');
            if (withdrawalFee > 0) {
                withdrawalFeeAmount.textContent = `${rateInfo.symbol} ${withdrawalFee.toLocaleString('ko-KR')}`;
                withdrawalFeeRow.style.display = 'flex';
            } else {
                withdrawalFeeRow.style.display = 'none';
            }

            document.getElementById('calcResult').style.display = 'block';
        }

        // 송금 신청
        function submitRemittance() {
            // 필수 항목 검증
            const requiredFields = [
                { id: 'remitCountry', name: '국가' },
                { id: 'remitService', name: '서비스' },
                { id: 'sendAmount', name: '송금 금액' },
                { id: 'depositBank', name: '입금 은행' },
                { id: 'depositorName', name: '입금자 명' },
                { id: 'depositAccount', name: '입금 계좌' },
                { id: 'accountHolder', name: '입금 계좌 명의' },
                { id: 'beneficiaryName', name: '수취인명' },
                { id: 'relationship', name: '수취인과의 관계' },
                { id: 'beneficiaryBank', name: '수취 은행' },
                { id: 'beneficiaryAccount', name: '수취 계좌 번호' },
                { id: 'accountType', name: '수취 계좌 타입' },
                { id: 'remitPurpose', name: '송금 목적' },
                { id: 'fundSource', name: '자금 출처' },
                { id: 'beneficiaryPhone', name: '전화번호' },
                { id: 'beneficiaryAddress', name: '주소' }
            ];

            for (const field of requiredFields) {
                const element = document.getElementById(field.id);
                if (!element.value || element.value.trim() === '') {
                    showWarning(`${field.name}를 입력해주세요.`);
                    element.focus();
                    return;
                }
            }

            // 송금 금액 검증
            const sendAmount = parseFloat(document.getElementById('sendAmount').value.replace(/,/g, ''));
            const maxKRW = 50000 * 1350; // $50,000 한도

            if (sendAmount > maxKRW) {
                showWarning(`1회 송금 한도(${maxKRW.toLocaleString('ko-KR')}원)를 초과했습니다.`);
                return;
            }

            // 송금 신청 완료 모달 표시
            document.getElementById('remitCompleteModal').classList.add('active');
        }

        // 모달 닫기
        function closeRemitModal() {
            document.getElementById('remitCompleteModal').classList.remove('active');
            location.href = 'dashboard.html';
        }

        // 한도 초과 모달
        function showLimitModal(message) {
            document.getElementById('limitModalMessage').innerHTML = message;
            document.getElementById('limitModal').classList.add('active');
        }

        function closeLimitModal() {
            document.getElementById('limitModal').classList.remove('active');
        }

        // 경고 모달
        function showWarning(message) {
            document.getElementById('warningMessage').textContent = message;
            document.getElementById('warningModal').classList.add('active');
        }

        function closeWarningModal() {
            document.getElementById('warningModal').classList.remove('active');
        }

        // URL 파라미터에서 금액과 국가 읽어서 자동 설정
        window.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const amount = urlParams.get('amount');
            const country = urlParams.get('country');

            if (amount && country) {
                // 국가 선택
                const countrySelect = document.getElementById('remitCountry');
                countrySelect.value = country;

                // 국가 선택 이벤트 트리거 (서비스, 은행, 환율 업데이트)
                const event = new Event('change');
                countrySelect.dispatchEvent(event);

                // 금액 입력
                setTimeout(function() {
                    const sendAmountInput = document.getElementById('sendAmount');
                    sendAmountInput.value = parseFloat(amount).toLocaleString('ko-KR');

                    // 자동 계산 실행
                    setTimeout(function() {
                        calculateRemit();
                    }, 100);
                }, 100);
            }
        });
    </script>
</body>
</html>
