<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>withremit - 해외 송금 신청</title>

    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/variable/pretendardvariable.min.css" rel="stylesheet">

    <link rel="stylesheet" href="css/style.css">

    <link rel="icon" type="image/png" href="images/favicon.png">
</head>
<body class="db-body">
    <div id="headerContainer"></div>

    <main class="db-main-container container">
        <div class="db-layout-flex">
            <div id="sidebarContainer"></div>

            <div class="db-content">
                <div class="db-page-header">
                    <h1 class="db-page-title">해외 송금 신청</h1>
                </div>

                <div class="db-content-card">
                    <!-- 한도액 안내 -->
                    <div class="remit-limit-section">
                        <h2 class="form-sec-head">한도액 안내</h2>
                    <div class="limit-info-grid">
                        <div class="limit-info-item">
                            <div class="limit-label">1회 한도액</div>
                            <div class="limit-value">$ 5,000</div>
                        </div>
                        <div class="limit-info-item">
                            <div class="limit-label">1년 한도액</div>
                            <div class="limit-value">$ 100,000</div>
                        </div>
                        <div class="limit-info-item">
                            <div class="limit-label">송금액</div>
                            <div class="limit-value">$ 0</div>
                        </div>
                        <div class="limit-info-item highlight">
                            <div class="limit-label">송금 가능 금액</div>
                            <div class="limit-value">$ 100,000.00</div>
                        </div>
                    </div>
                </div>

                <!-- 송금 정보 입력 -->
                <div class="remit-form-section">
                    <h2 class="form-sec-head">송금 정보 입력</h2>

                    <div class="form-sec">
                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">국가</label>
                                <select class="login-input select-styled" id="remitCountry">
                                    <option value="" disabled selected>송금 국가 선택</option>
                                    <option value="JP">일본 (JPY)</option>
                                    <option value="PH">필리핀 (PHP)</option>
                                    <option value="CN">중국 (CNY)</option>
                                    <option value="NP">네팔 (NPR)</option>
                                    <option value="AU">호주 (AUD)</option>
                                    <option value="HK">홍콩 (HKD)</option>
                                    <option value="MN">몽골 (MNT)</option>
                                    <option value="VN">베트남 (VND)</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">서비스 선택</label>
                                <select class="login-input select-styled" id="remitService">
                                    <option value="" disabled selected>송금 서비스 선택</option>
                                    <option value="standard">일반 송금</option>
                                    <option value="express">빠른 송금</option>
                                </select>
                            </div>
                        </div>

                        <div class="field-item top-level">
                            <label class="field-label">송금액 설정</label>
                            <div class="field-flex h-52">
                                <label class="radio-wrap">
                                    <input type="radio" name="amountType" value="send" checked>
                                    <span class="custom-radio"></span>
                                    <span>송금액 기준</span>
                                </label>
                                <label class="radio-wrap">
                                    <input type="radio" name="amountType" value="receive">
                                    <span class="custom-radio"></span>
                                    <span>수취금액 기준</span>
                                </label>
                            </div>
                        </div>

                        <div class="field-item top-level">
                            <label class="field-label">송금 금액</label>
                            <div class="field-flex">
                                <input type="text" placeholder="송금 금액을 입력하세요" class="login-input" id="sendAmount">
                                <button type="button" class="btn-sub-action" onclick="calculateRemit()">계산</button>
                            </div>
                        </div>

                        <div class="remit-calc-result">
                            <div class="calc-result-row">
                                <span class="calc-label">송금 수수료</span>
                                <span class="calc-value" id="remitFee">-</span>
                            </div>
                            <div class="calc-result-row">
                                <span class="calc-label">수취 금액</span>
                                <span class="calc-value" id="receiveAmount">-</span>
                            </div>
                            <div class="calc-result-row">
                                <span class="calc-label">환율</span>
                                <span class="calc-value" id="exchangeRate">국가를 선택해주세요.</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 입금은행 선택 -->
                <div class="remit-form-section">
                    <h2 class="form-sec-head">입금은행 선택</h2>

                    <div class="form-sec">
                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">입금 은행</label>
                                <select class="login-input select-styled" id="depositBank">
                                    <option value="" disabled selected>은행 선택</option>
                                    <option value="kb">국민은행</option>
                                    <option value="shinhan">신한은행</option>
                                    <option value="woori">우리은행</option>
                                    <option value="hana">하나은행</option>
                                    <option value="nh">농협은행</option>
                                    <option value="ibk">기업은행</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">입금자 명</label>
                                <input type="text" placeholder="입금자 명을 입력하세요" class="login-input" id="depositorName">
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">입금 계좌</label>
                                <input type="text" placeholder="계좌번호를 입력하세요" class="login-input" id="depositAccount">
                            </div>
                            <div class="field-item">
                                <label class="field-label">입금 계좌 명의</label>
                                <input type="text" placeholder="계좌 명의를 입력하세요" class="login-input" id="accountHolder">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 수취 정보 입력 -->
                <div class="remit-form-section">
                    <h2 class="form-sec-head">수취 정보 입력</h2>

                    <div class="form-sec">
                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">수취인명(영문)</label>
                                <input type="text" placeholder="영문으로 입력하세요" class="login-input" id="beneficiaryName">
                            </div>
                            <div class="field-item">
                                <label class="field-label">수취인과의 관계</label>
                                <select class="login-input select-styled" id="relationship">
                                    <option value="" disabled selected>관계 선택</option>
                                    <option value="self">본인</option>
                                    <option value="family">가족</option>
                                    <option value="friend">친구</option>
                                    <option value="business">비즈니스</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">수취 은행</label>
                                <select class="login-input select-styled" id="beneficiaryBank">
                                    <option value="" disabled selected>국가를 선택해주세요</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">은행 지점번호</label>
                                <input type="text" placeholder="지점번호를 입력하세요" class="login-input" id="branchNumber">
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">수취 계좌 번호</label>
                                <input type="text" placeholder="계좌번호를 입력하세요" class="login-input" id="beneficiaryAccount">
                            </div>
                            <div class="field-item">
                                <label class="field-label">수취 계좌 타입</label>
                                <select class="login-input select-styled" id="accountType">
                                    <option value="" disabled selected>계좌 타입 선택</option>
                                    <option value="savings">저축예금</option>
                                    <option value="checking">당좌예금</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">송금 목적</label>
                                <select class="login-input select-styled" id="remitPurpose">
                                    <option value="" disabled selected>송금 목적 선택</option>
                                    <option value="family">가족 송금</option>
                                    <option value="education">교육비</option>
                                    <option value="living">생활비</option>
                                    <option value="medical">의료비</option>
                                    <option value="business">사업</option>
                                    <option value="investment">투자</option>
                                    <option value="gift">선물</option>
                                    <option value="other">기타</option>
                                </select>
                            </div>
                            <div class="field-item">
                                <label class="field-label">자금 출처</label>
                                <select class="login-input select-styled" id="fundSource">
                                    <option value="" disabled selected>자금 출처 선택</option>
                                    <option value="salary">급여</option>
                                    <option value="business">사업소득</option>
                                    <option value="savings">저축</option>
                                    <option value="investment">투자수익</option>
                                    <option value="loan">대출</option>
                                    <option value="other">기타</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row-2">
                            <div class="field-item">
                                <label class="field-label">전화번호</label>
                                <input type="text" placeholder="수취인 전화번호" class="login-input" id="beneficiaryPhone">
                            </div>
                            <div class="field-item">
                                <label class="field-label">은행 지점번호</label>
                                <input type="text" placeholder="은행 지점번호를 입력하세요" class="login-input" id="bankBranchNumber">
                            </div>
                        </div>

                        <div class="field-item top-level">
                            <label class="field-label">주소</label>
                            <textarea class="login-input textarea-input" placeholder="수취인 주소를 입력하세요" id="beneficiaryAddress" rows="3"></textarea>
                        </div>
                    </div>
                </div>

                    <!-- 하단 버튼 -->
                    <div class="remit-action-btns">
                        <button type="button" class="btn btn-outline btn-remit-cancel" onclick="location.href='dashboard.html'">취소</button>
                        <button type="button" class="btn btn-primary" onclick="submitRemittance()">송금 신청</button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="contactContainer"></div>
    <div id="footerContainer"></div>

    <div class="db-overlay" id="dbOverlay"></div>

    <!-- 송금 신청 완료 모달 -->
    <div id="remitCompleteModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#00A0DC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                    <polyline points="22 4 12 14.01 9 11"></polyline>
                </svg>
            </div>
            <h3>송금 신청 완료</h3>
            <p>송금 신청이 정상적으로 접수되었습니다.<br>처리 결과는 SMS 및 이메일로 안내드립니다.</p>
            <button class="modal-btn-warning" style="background-color: var(--primary-green);" onclick="closeRemitModal()">확인</button>
        </div>
    </div>

    <!-- 경고 모달 -->
    <div id="warningModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-icon">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#f59e0b" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                    <line x1="12" y1="9" x2="12" y2="13"></line>
                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
            </div>
            <h3 id="warningTitle">안내</h3>
            <p id="warningMessage"></p>
            <button class="modal-btn-warning" onclick="closeWarningModal()">확인</button>
        </div>
    </div>

    <script src="js/sidebar.js"></script>
    <script src="js/includes.js"></script>
    <script>
        // 환율 데이터
        const exchangeRates = {
            JP: { rate: 0.1112, name: '일본', currency: '엔', symbol: '¥' },
            PH: { rate: 0.0421, name: '필리핀', currency: '페소', symbol: '₱' },
            CN: { rate: 0.0054, name: '중국', currency: '위안', symbol: '¥' },
            NP: { rate: 0.1004, name: '네팔', currency: '루피', symbol: 'रू' },
            AU: { rate: 0.0011, name: '호주', currency: '달러', symbol: 'A$' },
            HK: { rate: 0.0059, name: '홍콩', currency: '달러', symbol: 'HK$' },
            MN: { rate: 2.5830, name: '몽골', currency: '투그릭', symbol: '₮' },
            VN: { rate: 18.5200, name: '베트남', currency: '동', symbol: '₫' }
        };

        // 국가별 은행 목록
        const banksByCountry = {
            JP: ['미쓰비시UFJ은행', '미즈호은행', '스미토모미쓰이은행', '리소나은행'],
            PH: ['BDO', 'BPI', 'Metrobank', 'Security Bank'],
            CN: ['중국공상은행', '중국건설은행', '중국은행', '중국농업은행'],
            NP: ['Nepal Bank', 'Rastriya Banijya Bank', 'Nabil Bank', 'Standard Chartered'],
            AU: ['Commonwealth Bank', 'Westpac', 'ANZ', 'NAB'],
            HK: ['HSBC', 'Standard Chartered', 'Bank of China (HK)', 'Hang Seng Bank'],
            MN: ['Khan Bank', 'Golomt Bank', 'Trade and Development Bank', 'State Bank'],
            VN: ['Vietcombank', 'BIDV', 'VietinBank', 'Agribank']
        };

        // 국가 선택 시 은행 목록 업데이트
        document.getElementById('remitCountry').addEventListener('change', function() {
            const country = this.value;
            const bankSelect = document.getElementById('beneficiaryBank');

            // 은행 목록 초기화
            bankSelect.innerHTML = '<option value="" disabled selected>은행 선택</option>';

            // 선택된 국가의 은행 목록 추가
            if (banksByCountry[country]) {
                banksByCountry[country].forEach(bank => {
                    const option = document.createElement('option');
                    option.value = bank;
                    option.textContent = bank;
                    bankSelect.appendChild(option);
                });
            }

            // 환율 표시 업데이트
            if (exchangeRates[country]) {
                const rateInfo = exchangeRates[country];
                document.getElementById('exchangeRate').textContent =
                    `1 KRW = ${rateInfo.rate.toFixed(4)} ${rateInfo.currency}`;
            }
        });

        // 송금 금액 계산
        function calculateRemit() {
            const country = document.getElementById('remitCountry').value;
            const sendAmountInput = document.getElementById('sendAmount').value;

            if (!country) {
                showWarning('송금 국가를 먼저 선택해주세요.');
                return;
            }

            if (!sendAmountInput) {
                showWarning('송금 금액을 입력해주세요.');
                return;
            }

            const sendAmount = parseFloat(sendAmountInput.replace(/,/g, ''));

            if (isNaN(sendAmount) || sendAmount <= 0) {
                showWarning('올바른 금액을 입력해주세요.');
                return;
            }

            // 수수료 계산 (1%)
            const feeRate = country === 'NP' ? 0.005 : 0.01;
            const fee = sendAmount * feeRate;

            // 환율 적용
            const rate = exchangeRates[country].rate;
            const receiveAmt = (sendAmount - fee) * rate;

            // 결과 표시
            document.getElementById('remitFee').textContent =
                fee.toLocaleString('ko-KR') + ' KRW';
            document.getElementById('receiveAmount').textContent =
                receiveAmt.toLocaleString('ko-KR', {maximumFractionDigits: 2}) + ' ' + exchangeRates[country].currency;
        }

        // 송금 신청
        function submitRemittance() {
            // 필수 항목 검증
            const requiredFields = [
                { id: 'remitCountry', name: '국가' },
                { id: 'remitService', name: '서비스 선택' },
                { id: 'sendAmount', name: '송금 금액' },
                { id: 'depositBank', name: '입금 은행' },
                { id: 'depositorName', name: '입금자 명' },
                { id: 'depositAccount', name: '입금 계좌' },
                { id: 'accountHolder', name: '입금 계좌 명의' },
                { id: 'beneficiaryName', name: '수취인명' },
                { id: 'relationship', name: '수취인과의 관계' },
                { id: 'beneficiaryBank', name: '수취 은행' },
                { id: 'beneficiaryAccount', name: '수취 계좌 번호' },
                { id: 'accountType', name: '수취 계좌 타입' },
                { id: 'remitPurpose', name: '송금 목적' },
                { id: 'fundSource', name: '자금 출처' },
                { id: 'beneficiaryPhone', name: '전화번호' },
                { id: 'beneficiaryAddress', name: '주소' }
            ];

            for (const field of requiredFields) {
                const element = document.getElementById(field.id);
                if (!element.value || element.value.trim() === '') {
                    showWarning(`${field.name}을(를) 입력해주세요.`);
                    element.focus();
                    return;
                }
            }

            // 송금 금액 검증
            const sendAmount = parseFloat(document.getElementById('sendAmount').value.replace(/,/g, ''));
            const maxKRW = 5000 * 1350; // $5,000 한도

            if (sendAmount > maxKRW) {
                showWarning(`1회 송금 한도(${maxKRW.toLocaleString('ko-KR')}원)를 초과했습니다.`);
                return;
            }

            // 송금 신청 완료 모달 표시
            document.getElementById('remitCompleteModal').classList.add('active');
        }

        // 모달 닫기
        function closeRemitModal() {
            document.getElementById('remitCompleteModal').classList.remove('active');
            location.href = 'dashboard.html';
        }

        // 경고 모달
        function showWarning(message) {
            document.getElementById('warningMessage').textContent = message;
            document.getElementById('warningModal').classList.add('active');
        }

        function closeWarningModal() {
            document.getElementById('warningModal').classList.remove('active');
        }

        // 송금액 입력 포맷팅
        document.getElementById('sendAmount').addEventListener('input', function(e) {
            let value = e.target.value.replace(/,/g, '');
            if (!isNaN(value) && value !== '') {
                e.target.value = parseFloat(value).toLocaleString('ko-KR');
            }
        });
    </script>
</body>
</html>
